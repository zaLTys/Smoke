@page "/scenario"
@using UI.Components.Loader
@using UI.ViewModels.Scenarios
@inherits DataLoader


<Content State="@State" ErrorMessage="@ErrorMessage">
    <MudContainer Style="max-width: 10000px; width: 100%; margin-left: 0;">
        <MudGrid>
            <MudItem xs="12" sm="6" md="6" lg="6">
                <MudPaper Class="pa-4 my-2" Style="width:100%;">
                    <MudText Typo="Typo.h6">Register scenario</MudText>
                    <MudGrid>
                        <MudItem xs="12">
                            <MudTextField Label="Name"
                                          @bind-Value="ScenarioNameToRegister"
                                          Variant="Variant.Outlined">

                            </MudTextField>
                        </MudItem>
                        <MudItem xs="6">
                            <MudButton Variant="Variant.Outlined"
                                       ButtonType="ButtonType.Submit"
                                       StartIcon="@Icons.Material.Filled.Check"
                                       DisableElevation="true"
                                       Size="Size.Small"
                                       Style="background-color: white;"
                                       Color="Color.Primary"
                                       OnClick="Register">
                                Register
                            </MudButton>
                        </MudItem>

                    </MudGrid>
                </MudPaper>
                <MudPaper Class="pa-4 my-2" Style="width:100%;">
                    <MudText Typo="Typo.h6">Registered Scenario</MudText>
                    <MudGrid>
                        <MudItem xs="12">
                            <MudTextField Label="Id" @bind-Value="RegisteredScenario.Id" ReadOnly="true" Variant="Variant.Outlined" />
                        </MudItem>
                        <MudItem xs="6">
                            <MudTextField Label="Name" @bind-Value="RegisteredScenario.Name" Variant="Variant.Outlined" />
                        </MudItem>

                        <MudItem xs="12">
                            <MudText Typo="Typo.h6" Class="mb-4">Steps</MudText>
                            <MudDropContainer T="ScenarioStepViewModel" Items="ScenarioSteps" ItemsSelector="@((item, dropzone) => true)" ItemDropped="OnDrop" Class="d-flex flex-wrap flex-grow-1">
                                <ChildContent>
                                    <MudDropZone T="ScenarioStepViewModel" Identifier="Drop Zone 1" Class="rounded mud-background-gray pa-6 ma-8 flex-grow-1" AllowReorder="true">
                                    </MudDropZone>
                                </ChildContent>
                                <ItemRenderer>
                                    <MudGrid>
                                        <MudItem xs="12">
                                            <MudPaper Elevation="25" Class="d-flex align-items-center">
                                                <MudText Class="mx-2">@context.RequestName</MudText>
                                                <MudText Class="mx-2">@context.StepType</MudText>
                                                <MudText Class="mx-2">@context.Order</MudText>
                                                <MudTextField @bind-Value="context.TimeOut" Variant="Variant.Text" Class="mx-2" />
                                                <MudTextField @bind-Value="context.DelayAfter" Variant="Variant.Text" Class="mx-2" />
                                                <MudIconButton Icon="@Icons.Material.Filled.Delete" Color="Color.Error" OnClick="(() => RemoveStep(context))" Class="mx-2" />
                                            </MudPaper>
                                        </MudItem>
                                    </MudGrid>
                                </ItemRenderer>
                            </MudDropContainer>
                        </MudItem>

                        <!-- Headers Table -->
                        <MudItem xs="12">
                            <MudText Typo="Typo.h6">Steps</MudText>
                            <MudTable Items="ScenarioSteps" Bordered="true" Hover="false">
                                <HeaderContent>
                                    <MudTh>RequestName</MudTh>
                                    <MudTh>Type</MudTh>
                                    <MudTh>Order</MudTh>
                                    <MudTh>Timeout</MudTh>
                                    <MudTh>DelayAfter</MudTh>
                                    <MudTh>Act</MudTh>
                                </HeaderContent>
                                <RowTemplate>
                                    <MudTd>
                                        <MudText>@context.RequestName</MudText>
                                    </MudTd>
                                    <MudTd>
                                        <MudText>@context.StepType</MudText>
                                    </MudTd>
                                    <MudTd>
                                        <MudText>@context.Order</MudText>
                                    </MudTd>
                                    <MudTd>
                                        <MudTextField @bind-Value="context.TimeOut" Variant="Variant.Outlined" />
                                    </MudTd>
                                    <MudTd>
                                        <MudTextField @bind-Value="context.DelayAfter" Variant="Variant.Outlined" />
                                    </MudTd>
                                    <MudTd>
                                        <MudIconButton Icon="@Icons.Material.Filled.Delete" Color="Color.Error" OnClick="(() => RemoveStep(context))" />
                                    </MudTd>
                                </RowTemplate>
                            </MudTable>
                            <MudSpacer />
                        </MudItem>
                    </MudGrid>
                </MudPaper>
            </MudItem>

            <MudItem xs="6" sm="6" md="6" lg="6">
                <UI.Components.Lists.ApiRequestList OnRequestSelected="AddStep">
                </UI.Components.Lists.ApiRequestList>
            </MudItem>
        </MudGrid>
    </MudContainer>
</Content>